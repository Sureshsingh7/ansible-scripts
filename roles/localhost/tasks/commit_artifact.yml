--- 
- name: Creates directories if not available
  file:
    path: "{{ item }}"
    state: directory
  with_items:
  - 'roles/localhost/files/artifact_server'

- name: Clone artifact repository from github
  shell: |
    cd roles/localhost/files/artifact_server/
    git initclear
    git config core.sparsecheckout true
    echo artifactory >> .git/info/sparse-checkout
    git remote add -f origin https://Sureshsingh7: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@github.com/Sureshsingh7/ansible-scripts.git
    git pull origin master

# - name: Creates directories if not available
#   file:
#     path: "{{ item }}"
#     state: directory
#   with_items:
#   - 'roles/localhost/files/artifact_server/{{ windows_artifacts }}'
#   - 'roles/localhost/files/artifact_server/{{ snowflake_artifacts }}'

- name: Copying artifacts to github repo
  copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
  with_items:
    - { src: 'roles/localhost/files/artifacts/{{ windows_artifacts }}-{{ artifact_version }}.zip', dest: 'roles/localhost/files/artifact_server/artifactory/windows_artifacts/{{ windows_artifacts }}-{{ artifact_version }}.zip' }
    - { src: 'roles/localhost/files/artifacts/{{ snowflake_artifacts }}-{{ artifact_version }}.zip', dest: 'roles/localhost/files/artifact_server/artifactory/snowflake_artifacts/{{ snowflake_artifacts }}-{{ artifact_version }}.zip' }

- name: commit artifacts to github
  shell: |
    cd 'roles/localhost/files/artifact_server/artifactory'
    git add .
    git commit -m "artifacts added to git repo"
    git push https://Sureshsingh7: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@github.com/Sureshsingh7/ansible-scripts.git --all
